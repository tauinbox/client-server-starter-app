<div class="user-search-container">
  <mat-card class="full-width">
    <mat-card-header>
      <mat-card-title>Search Users</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="searchForm" (ngSubmit)="onSubmit()">
        <div class="search-fields">
          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input
              matInput
              formControlName="email"
              placeholder="Search by email"
            />
            <mat-icon matPrefix>email</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>First Name</mat-label>
            <input
              matInput
              formControlName="firstName"
              placeholder="Search by first name"
            />
            <mat-icon matPrefix>person</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Last Name</mat-label>
            <input
              matInput
              formControlName="lastName"
              placeholder="Search by last name"
            />
            <mat-icon matPrefix>person</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Status</mat-label>
            <mat-select formControlName="isActive">
              <mat-option value="">All</mat-option>
              <mat-option value="true">Active</mat-option>
              <mat-option value="false">Inactive</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="search-actions">
          @let isSearching = searching();
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="isSearching"
          >
            <mat-icon>search</mat-icon>
            Search
          </button>

          <button
            mat-button
            type="button"
            (click)="resetForm()"
            [disabled]="isSearching"
          >
            Clear
          </button>
        </div>
      </form>

      <mat-divider class="my-4"></mat-divider>

      @if (searched()) {
        @if (searchTotalUsers() === 0) {
          <div class="empty-state">
            <mat-icon class="empty-icon">search_off</mat-icon>
            <h3>No Users Found</h3>
            <p>
              No users match your search criteria. Try adjusting your filters.
            </p>
          </div>
        } @else {
          <div class="results-header">
            <h3>Search Results</h3>
            <span class="results-count"
              >{{ searchTotalUsers() }} user(s) found</span
            >
          </div>

          <app-user-table
            [users]="users()"
            (sortChange)="searchSortData($event)"
            (deleteUser)="confirmDelete($event)"
          />
        }
      }

      <div #scrollSentinel class="scroll-sentinel"></div>

      @if (isLoadingMoreSearch()) {
        <div class="load-more-container">
          <mat-spinner [diameter]="36"></mat-spinner>
        </div>
      }
    </mat-card-content>
  </mat-card>
</div>
