<div class="reset-password-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Reset Password</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      @if (invalidToken()) {
        <div class="status-container error">
          <mat-icon>error_outline</mat-icon>
          <h3>Invalid Reset Link</h3>
          <p>{{ error() }}</p>
          <button
            mat-raised-button
            color="primary"
            routerLink="/forgot-password"
          >
            Request New Reset Link
          </button>
        </div>
      } @else {
        <p class="instructions">Enter your new password below.</p>

        <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()">
          <mat-form-field class="full-width">
            <mat-label>New Password</mat-label>
            <input
              matInput
              [type]="pwdToggle.show() ? 'text' : 'password'"
              formControlName="password"
              placeholder="Enter new password"
              required
            />
            <mat-icon matPrefix>lock</mat-icon>
            <app-password-toggle #pwdToggle />
            @if (
              resetPasswordForm.get('password')?.invalid &&
              resetPasswordForm.get('password')?.touched
            ) {
              <mat-error>
                @if (resetPasswordForm.get('password')?.errors?.['required']) {
                  Password is required
                } @else if (
                  resetPasswordForm.get('password')?.errors?.['minlength']
                ) {
                  Password must be at least 8 characters
                }
              </mat-error>
            }
          </mat-form-field>

          <mat-form-field class="full-width">
            <mat-label>Confirm Password</mat-label>
            <input
              matInput
              [type]="confirmPwdToggle.show() ? 'text' : 'password'"
              formControlName="confirmPassword"
              [errorStateMatcher]="confirmPasswordErrorMatcher"
              placeholder="Confirm new password"
              required
            />
            <mat-icon matPrefix>lock</mat-icon>
            <app-password-toggle #confirmPwdToggle />
            <mat-error>Passwords do not match</mat-error>
          </mat-form-field>

          @if (error()) {
            <div class="error-message">
              {{ error() }}
            </div>
          }

          <div class="form-actions">
            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="resetPasswordForm.invalid || loading()"
            >
              @if (loading()) {
                <mat-spinner diameter="24"></mat-spinner>
                <span class="ml-2">Resetting...</span>
              } @else {
                Reset Password
              }
            </button>
          </div>
        </form>
      }
    </mat-card-content>
  </mat-card>
</div>
